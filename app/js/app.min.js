"use strict";function AppConfig(e,r,t,o){e.otherwise({redirectTo:"/error"}),t.setPrefix("footyfeeds");var n=function(e){return{request:function(r){var t=e.get("UserService").getActiveUser();return t&&t.token&&(r.headers.authorization="Bearer "+t.token),r}}};n.$inject=["$injector"],r.interceptors.push(n)}function AboutRoute(e){e.when("/about",{templateUrl:"about/about.template.html"})}function NewsRoute(e){var r={templateUrl:"news/news.template.html",controller:"NewsController",controllerAs:"vm"};e.when("/",r).when("/news",r).when("/news/team/:team?",r)}function ErrorRoute(e){e.when("/error",{templateUrl:"components/error/error.template.html"})}function ArticleDetailRoute(e){e.when("/news/article/:articleID?",{templateUrl:"news/article-detail/article-detail.template.html",controller:"ArticleDetailController",controllerAs:"vm"})}function SourceDetailRoute(e){e.when("/news/source/:sourceID/",{templateUrl:"sources/source-detail/source-detail.template.html",controller:"SourceDetailController",controllerAs:"vm"})}function AccountRoute(e){e.when("/account",{templateUrl:"users/account/account.template.html",controller:"AccountController",controllerAs:"vm"})}function LoginRoute(e){e.when("/login",{templateUrl:"users/login/login.template.html",controller:"LoginController",controllerAs:"vm"})}function LogoutRoute(e){e.when("/logout",{templateUrl:"users/logout/logout.template.html",controller:"LogoutController",controllerAs:"vm"})}function RegisterRoute(e){e.when("/register",{templateUrl:"users/register/register.template.html",controller:"RegisterController",controllerAs:"vm"})}function FiltersService(e,r){function t(e){return n[e]}function o(t,o,l){n[t]=o,"team"==t&&(l&&(n.page=0,n.scrollY=null),null!==o?(n.sources=e.getSources(o)||[],r.path("/news/team/"+o.urlFriendlyName)):(n.sources=null,r.path("/news")))}var n={team:null,sources:null,page:0,scrollY:null};return{getActiveFilter:t,setActiveFilter:o}}function NewsService(e,r,t){function o(e,o,n){var u=c;if(null!=o&&(u=u+"/team/"+o.urlFriendlyName,null!=n&&0!=n.length)){var s=n.filter(function(e){return e.enabled}).map(function(e){return e.sourceID});if(0==s.length)return t(function(e,r){r("No sources enabled")});u=u+"/sources/"+s.join("-")}return r.get(u+"/page/"+e).then(l).then(function(e){return e.filter(function(e){return null!==e.articleID})})["catch"](i)}function n(e){return r.get(c+"/article/"+e).then(l)["catch"](i)}function l(e){return e.data}function i(e){return console.error(e),e}var c=e+"/news";return{getArticles:o,getArticle:n}}function SourcesService(e,r,t){function o(o){return o?r.get(e+"/sources/team/"+o.urlFriendlyName).then(l).then(function(e){var r=t.getSources(o);return e.map(function(e){if(r){var t=r.sources.find(function(r){return e.sourceID==r.sourceID});e.enabled=null==t?!0:t.enabled}else e.enabled=!0;return e})})["catch"](i):i("No team selected")}function n(t){return t?r.get(e+"/source/"+t).then(l)["catch"](i):i("No source provided")}function l(e){return e.data}function i(e){return console.error(e),e}return{getSources:o,getSource:n}}function TeamsService(e,r){function t(){return r.get(e+"/leagues").then(l)["catch"](i)}function o(t){return r.get(e+"/teams/"+t.urlFriendlyName).then(l)["catch"](i)}function n(t){return r.get(e+"/team/"+t).then(l)["catch"](i)}function l(e){return e.data}function i(e){return console.error(e),e}return{getLeagues:t,getTeams:o,getTeam:n}}function UserService(e,r,t){function o(){var e=t.get("activeUser");return e&&e.userID?e:null}function n(e){if(e){var r={userID:e.userID,username:e.username,token:e.token,userSources:e.userSources||{}};t.set("activeUser",r)}else t.set("activeUser",null)}function l(){return null!==o()}function i(r){return e.post(g+"/register",{user:r}).then(f).then(function(e){return e.success&&n(e.user),e})["catch"](d)}function c(r,t){return e.post(g+"/login",{username:r,password:t}).then(f).then(function(e){return e.success&&n(e.user),e})["catch"](d)}function u(){return l()?e["delete"](g+"/delete",{userID:o().userID}).then(f).then(function(e){return e.success&&n(null),e})["catch"](d):d("Must be logged in")}function s(r,t){if(!l())return m[r.urlFriendlyName]={team:{teamID:r.teamID,teamName:r.teamName},sources:t},!0;var i=o();return i.userSources[r.urlFriendlyName]={team:{teamID:r.teamID,teamName:r.teamName},sources:t.map(function(e){return{sourceID:e.sourceID,sourceName:e.sourceName,enabled:e.enabled}})},n(i),e.post(g+"/sources",{userSources:i.userSources})["catch"](d)}function a(e){var r=o();if(!r)return null!=m&&null!=m[e.urlFriendlyName]?m[e.urlFriendlyName]:null;var t=r.userSources;return t&&null!=t[e.urlFriendlyName]?t[e.urlFriendlyName]:null}function f(e){return e.data}function d(e){return console.error(e),e}var g=r+"/user",m={};return{getActiveUser:o,setActiveUser:n,isLoggedIn:l,register:i,login:c,deleteAccount:u,updateSources:s,getSources:a}}function NewsController(e,r,t){function o(){e.team&&(c.team=e.team)}function n(e){u.push(e)}function l(e){var r=u.indexOf(e);r>=0&&u.splice(r,1)}function i(e){u.forEach(function(r){r(e)})}var c=this;c.currentPage=0,c.articles=[],c.team=null;var u=[];c.registerViewer=n,c.deregisterViewer=l,c.updateViewers=i,o()}function ArticleDetailController(e,r,t){function o(){r.getArticle(l.article.articleID).then(function(e){l.article=e,l.loading=!1})}function n(){var e=t.getActiveFilter("team");return null==e?"#/news":"#/news/team/"+e.urlFriendlyName}var l=this;l.loading=!0,l.article={articleID:e.articleID},l.getBackLink=n,o()}function SourceDetailController(e,r){function t(){console.log("??"),r.getSource(o.source.sourceID).then(function(e){o.source=e,o.loading=!1})}var o=this;o.loading=!0,o.source={sourceID:e.sourceID},t()}function AccountController(e,r,t,o){function n(){return l.activeUser?void(l.activeUser.userSources&&(l.teams=Object.keys(l.activeUser.userSources))):e.path("/")}var l=this;l.activeUser=r.getActiveUser(),l.teams=[],n()}function LoginController(e,r){function t(){r.isLoggedIn()&&e.path("/")}function o(){n.error={},n.loading=!0,r.login(n.username,n.password).then(function(r){n.loading=!1,r.success?e.path("/"):n.error=r.error||{message:"Error logging in, please try again"}})}var n=this;n.error={},n.login=o,t()}function LogoutController(e,r){function t(){r.setActiveUser(null),e.path("/")}t()}function RegisterController(e,r){function t(){r.isLoggedIn()&&e.path("/")}function o(){n.loading=!0,n.error={},r.register(n.user).then(function(r){n.loading=!1,r.success?e.path("/"):n.error=r.error||{message:"Error registering account, please try again"}})}var n=this;n.error={},n.register=o,t()}function FooterController(){}function HeaderController(e,r){function t(){l.collapsed=!l.collapsed}function o(){return e.isLoggedIn()}function n(){var e=r.getActiveFilter("team");return null==e?"#/news":"#/news/team/"+e.urlFriendlyName}var l=this;l.collapsed=!0,l.collapse=t,l.isLoggedIn=o,l.getHomeLink=n}function NewsViewerController(e,r,t,o,n){function l(){a.team||a.refresh(!1),a.registerViewer(a.refresh)}function i(t){1==t&&(a.articles=[],a.morePages=!0),a.error=!1,a.loading=!0;var o=r.getActiveFilter("team"),n=r.getActiveFilter("sources"),l=r.getActiveFilter("page");e.getArticles(l,o,n).then(function(e){a.loading=!1,0==e.length&&(a.morePages=!1),e.forEach(function(e){a.articles.push(e)}),f||(f=!1,s())},function(){a.loading=!1,a.error=!0,a.morePages=!1})}function c(e){e.preventDefault(),r.setActiveFilter("page",r.getActiveFilter("page")+1),a.refresh(!1)}function u(){var e=o.pageYOffset;r.setActiveFilter("scrollY",e)}function s(){var e=r.getActiveFilter("scrollY");e&&n(function(){o.scrollTo(0,e)})}var a=this,f=!0;a.loading=!0,a.morePages=!0,a.articles=[],a.error=!1,a.refresh=i,a.nextPage=c,t.$on("$routeChangeStart",u),l()}function NewsFiltersController(e,r,t,o,n){function l(){a.team?t.getTeam(a.team).then(function(r){r?(e.setActiveFilter("team",r),a.updateViewers(!1),i()):console.error("Team not found: "+a.team)}):e.setActiveFilter("team",null)}function i(){a.currentTeam=e.getActiveFilter("team")||{teamName:"No active team"},a.currentSources=e.getActiveFilter("sources")||"No filtered sources"}function c(){var r=o.openConfirm({template:"components/teams/pick/pick.template.html",controller:"PickTeamController",controllerAs:"vm"});r.then(function(r){e.setActiveFilter("team",r,!0),a.updateViewers(!0),i()},function(){})}function u(){var t=n.$new();t.team=a.currentTeam;var l=o.openConfirm({template:"components/sources/pick/pick.template.html",controller:"PickSourcesController",controllerAs:"vm",scope:t});l.then(function(t){e.setActiveFilter("sources",t),a.updateViewers(!0),r.updateSources(a.currentTeam,t),i()})}function s(){return null!=e.getActiveFilter("team")}var a=this;a.currentTeam={},a.currentSources={},l(),i(),a.changeTeam=c,a.changeSources=u,a.hasSelectedTeam=s}function PickSourcesController(e,r){function t(){r.getSources(n.team).then(function(e){n.sources=e,n.loading=!1})}function o(e){n.sources.map(function(r){return r.enabled=e,r})}var n=this;n.loading=!0,n.sources=[],n.team=e.getActiveFilter("team"),n.toggleAll=o,t()}function PickTeamController(e){function r(){e.getLeagues().then(function(e){n.leagues=e,n.loading=!1})}function t(r){n.selectedLeague=r,e.getTeams(n.selectedLeague).then(function(e){n.teams=e})}function o(e){n.selectedTeam=e}var n=this;n.loading=!0,n.leagues=[],n.selectedLeague=null,n.teams=[],n.selectedTeam=null,n.selectLeague=t,n.selectTeam=o,r()}function FooterDirective(){return{controller:"FooterController",controllerAs:"vm",templateUrl:"components/layout/footer/footer.template.html"}}function HeaderDirective(){return{scope:{},bindToController:{},controller:"HeaderController",controllerAs:"vm",templateUrl:"components/layout/header/header.template.html"}}function ArticleDirective(){return{restrict:"E",scope:{article:"="},controllerAs:"vm",templateUrl:"components/news/article/article.template.html"}}function NewsViewerDirective(){return{scope:{},bindToController:{registerViewer:"=",deregisterViewer:"=",team:"="},controller:"NewsViewerController",controllerAs:"vm",templateUrl:"components/news/viewer/viewer.template.html"}}function NewsFiltersDirective(){return{restrict:"E",scope:{},bindToController:{updateViewers:"=",team:"="},controller:"NewsFiltersController",controllerAs:"vm",templateUrl:"components/news/filters/filters.template.html"}}function ShortenFilter(){return function(e,r){return null==e?e:e.length<=r?e:e.substr(0,r-3)+"..."}}angular.module("footyfeeds",["ngRoute","ngDialog","LocalStorageModule","footyfeeds.services","footyfeeds.layout","footyfeeds.layout.header","footyfeeds.layout.footer","footyfeeds.about","footyfeeds.error","footyfeeds.users","footyfeeds.users.register","footyfeeds.users.login","footyfeeds.users.account","footyfeeds.users.logout","footyfeeds.news","footyfeeds.news.filters","footyfeeds.news.viewer","footyfeeds.news.article","footyfeeds.news.article-detail","footyfeeds.teams","footyfeeds.teams.pick","footyfeeds.sources","footyfeeds.sources.pick","footyfeeds.sources.source-detail"]).config(AppConfig).constant("API_BASE","http://footyfeeds.co.uk/api"),AppConfig.$inject=["$routeProvider","$httpProvider","localStorageServiceProvider","$anchorScrollProvider"],angular.module("footyfeeds.about",["ngRoute"]).config(AboutRoute),AboutRoute.$inject=["$routeProvider"],angular.module("footyfeeds.news",["ngRoute"]).config(NewsRoute),NewsRoute.$inject=["$routeProvider"],angular.module("footyfeeds.services",[]),angular.module("footyfeeds.sources",[]),angular.module("footyfeeds.teams",[]),angular.module("footyfeeds.users",[]),angular.module("footyfeeds.error",[]).config(ErrorRoute),ErrorRoute.$inject=["$routeProvider"],angular.module("footyfeeds.layout",[]),angular.module("footyfeeds.news.article-detail",["ngRoute"]).config(ArticleDetailRoute),ArticleDetailRoute.$inject=["$routeProvider"],angular.module("footyfeeds.sources.source-detail",["ngRoute"]).config(SourceDetailRoute),SourceDetailRoute.$inject=["$routeProvider"],angular.module("footyfeeds.users.account",["ngRoute"]).config(AccountRoute),AccountRoute.$inject=["$routeProvider"],angular.module("footyfeeds.users.login",["ngRoute"]).config(LoginRoute),LoginRoute.$inject=["$routeProvider"],angular.module("footyfeeds.users.logout",["ngRoute"]).config(LogoutRoute),LogoutRoute.$inject=["$routeProvider"],angular.module("footyfeeds.users.register",["ngRoute"]).config(RegisterRoute),RegisterRoute.$inject=["$routeProvider"],angular.module("footyfeeds.layout.footer",[]),angular.module("footyfeeds.layout.header",[]),angular.module("footyfeeds.news.article",[]),angular.module("footyfeeds.news.viewer",[]),angular.module("footyfeeds.news.filters",[]),angular.module("footyfeeds.sources.pick",[]),angular.module("footyfeeds.teams.pick",[]),angular.module("footyfeeds.services").service("FiltersService",FiltersService),FiltersService.$inject=["UserService","$location"],angular.module("footyfeeds.services").service("NewsService",NewsService),NewsService.$inject=["API_BASE","$http","$q"],angular.module("footyfeeds.services").service("SourcesService",SourcesService),SourcesService.$inject=["API_BASE","$http","UserService"],angular.module("footyfeeds.services").service("TeamsService",TeamsService),TeamsService.$inject=["API_BASE","$http"],angular.module("footyfeeds.services").service("UserService",UserService),UserService.$inject=["$http","API_BASE","localStorageService"],angular.module("footyfeeds.news").controller("NewsController",NewsController),NewsController.$inject=["$routeParams","FiltersService","TeamsService"],angular.module("footyfeeds.news.article-detail").controller("ArticleDetailController",ArticleDetailController),ArticleDetailController.$inject=["$routeParams","NewsService","FiltersService"],angular.module("footyfeeds.sources.source-detail").controller("SourceDetailController",SourceDetailController),SourceDetailController.$inject=["$routeParams","SourcesService"],angular.module("footyfeeds.users.account").controller("AccountController",AccountController),AccountController.$inject=["$location","UserService","TeamsService","$q"],angular.module("footyfeeds.users.login").controller("LoginController",LoginController),LoginController.$inject=["$location","UserService"],angular.module("footyfeeds.users.logout").controller("LogoutController",LogoutController),LogoutController.$inject=["$location","UserService"],angular.module("footyfeeds.users.register").controller("RegisterController",RegisterController),RegisterController.$inject=["$location","UserService"],angular.module("footyfeeds.layout.footer").controller("FooterController",FooterController),FooterController.$inject=[],angular.module("footyfeeds.layout.header").controller("HeaderController",HeaderController),HeaderController.$inject=["UserService","FiltersService"],angular.module("footyfeeds.news.viewer").controller("NewsViewerController",NewsViewerController),NewsViewerController.$inject=["NewsService","FiltersService","$scope","$window","$timeout"],angular.module("footyfeeds.news.filters").controller("NewsFiltersController",NewsFiltersController),NewsFiltersController.$inject=["FiltersService","UserService","TeamsService","ngDialog","$scope"],angular.module("footyfeeds.sources.pick").controller("PickSourcesController",PickSourcesController),PickSourcesController.$inject=["FiltersService","SourcesService"],angular.module("footyfeeds.teams.pick").controller("PickTeamController",PickTeamController),PickTeamController.$inject=["TeamsService"],angular.module("footyfeeds.layout.footer").directive("siteFooter",FooterDirective),FooterDirective.$inject=[],angular.module("footyfeeds.layout.header").directive("header",HeaderDirective),HeaderDirective.$inject=[],angular.module("footyfeeds.news.article").directive("article",ArticleDirective),angular.module("footyfeeds.news.viewer").directive("newsViewer",NewsViewerDirective),NewsViewerDirective.$inject=[],angular.module("footyfeeds.news.filters").directive("newsFilters",NewsFiltersDirective),NewsFiltersDirective.$inject=[],angular.module("footyfeeds.news.article").filter("shorten",ShortenFilter);